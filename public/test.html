<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Test Generator - Ai-Toolkit</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=DM+Sans:300,400,700|Indie+Flower" rel="stylesheet">
    
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
      /* Test Generator specific styles */
      .test-generator-section {
        background-color: #B2B2B2;
        padding: 2rem 0;
      }
      
      .test-container {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 2rem;
      }
      
      .test-header {
        background: #fd4d40;
        color: white;
        padding: 1rem;
        text-align: center;
      }
      
      .test-input-section {
        padding: 1.5rem;
        border-bottom: 1px solid #eee;
      }
      
      .topic-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #ddd;
        border-radius: 25px;
        outline: none;
        font-size: 1rem;
        margin-bottom: 1rem;
      }
      
      .topic-input:focus {
        border-color: #fd4d40;
      }
      
      .generate-btn {
        background-color: #fd4d40;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 0.75rem 2rem;
        cursor: pointer;
        transition: background-color 0.3s;
        font-weight: 600;
      }
      
      .generate-btn:hover {
        background-color: #e04438;
      }
      
      .test-content {
        padding: 1.5rem;
        max-height: 60vh;
        overflow-y: auto;
      }
      
      .question-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid #fd4d40;
      }
      
      .question-number {
        background: #fd4d40;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
        margin-right: 0.5rem;
      }
      
      .options-list {
        margin-top: 1rem;
      }
      
      .option-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 5px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .option-item:hover {
        border-color: #fd4d40;
        background: #fff5f5;
      }
      
      .option-item.selected {
        border-color: #3498db;
        background: #f0f8ff;
      }
      
      .option-item.correct {
        border-color: #16c3b0;
        background: #f0f9f7;
      }
      
      .option-item.incorrect {
        border-color: #fd4d40;
        background: #fff5f5;
      }
      
      .test-results {
        padding: 1.5rem;
        border-top: 1px solid #eee;
        display: none;
      }
      
      .result-item {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        border-radius: 5px;
      }
      
      .result-correct {
        background: #f0f9f7;
        border-left: 4px solid #16c3b0;
      }
      
      .result-incorrect {
        background: #fff5f5;
        border-left: 4px solid #fd4d40;
      }
      
      .score-display {
        text-align: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 1rem;
      }
      
      .score-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: #fd4d40;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0 auto 1rem;
      }
      
      .generating-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      
      .generating-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        text-align: center;
        max-width: 400px;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #fd4d40;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .submit-btn {
        background-color: #16c3b0;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 0.75rem 2rem;
        cursor: pointer;
        transition: background-color 0.3s;
        font-weight: 600;
        margin-top: 1rem;
      }
      
      .submit-btn:hover {
        background-color: #14b3a1;
      }
      
      .new-test-btn {
        background-color: #fdb62f;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 0.75rem 2rem;
        cursor: pointer;
        transition: background-color 0.3s;
        font-weight: 600;
        margin-top: 1rem;
      }
      
      .new-test-btn:hover {
        background-color: #eca61f;
      }

      .experience-gained {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        margin: 10px 0;
        text-align: center;
        font-weight: bold;
      }

      .level-up {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin: 10px 0;
        text-align: center;
        font-weight: bold;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
    </style>
  </head>

  <body data-spy="scroll" data-target=".site-navbar-target" data-offset="300" style="background-color: #B2B2B2;">

    <div class="site-wrap" id="home-section">

     <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
          <div class="site-mobile-menu-close mt-3">
            <span class="icon-close2 js-menu-toggle"></span>
          </div>
        </div>
        <div class="site-mobile-menu-body"></div>
     </div>

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <header class="site-navbar site-navbar-target" role="banner">
        <div class="container mb-3">
          <div class="d-flex align-items-center">
            <div class="site-logo mr-auto">
              <a href="index.html">Ai-Toolkit<span class="text-primary">.</span></a>
            </div>
            <div class="site-quick-contact d-none d-lg-flex ml-auto ">
              <div class="d-flex site-info align-items-center mr-5">
                <span class="block-icon mr-3"><span class="icon-map-marker text-yellow"></span></span>
                <span>School named after Sherkhan Murtaza <br>Taraz</span>
              </div>
              <div class="d-flex site-info align-items-center">
                <span class="block-icon mr-3"><span class="icon-clock-o"></span></span>
                <span>Under Development</span>
              </div>
            </div>
          </div>
        </div>

        <div class="container">
          <div class="menu-wrap d-flex align-items-center">
            <span class="d-inline-block d-lg-none"><a href="#" class="text-black site-menu-toggle js-menu-toggle py-5"><span class="icon-menu h3 text-black"></span></a></span>


            
            <nav class="site-navigation text-left mr-auto d-none d-lg-block" role="navigation">
              <ul class="site-menu main-menu js-clone-nav mr-auto ">
                  <li><a href="index.html" class="nav-link">Home</a></li>
                  <li><a href="chat.html" class="nav-link">Ai Assistant</a></li>
                  <li class="active"><a href="test.html" class="nav-link">Test Generator</a></li>
                  <li><a href="img.html" class="nav-link">Content Finder</a></li>
                  <li><a href="contact.html" class="nav-link">Contact</a></li>
                  <li><a href="edu.html" class="nav-link">Edu</a></li>
                  <li><a href="acc.html" class="nav-link">Account</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>

      <!-- –°–µ–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤ -->
      <div class="test-generator-section" style="margin-top: 50%;">
        <div class="container">
          <div class="row mb-5">
            <div class="col-12 text-center">
              <span class="text-cursive h5 text-red d-block">AI Test Generator</span>
              <h2 class="text-black">Create Custom Tests in Seconds</h2>
              <p class="lead">Generate personalized tests on any computer science topic with AI</p>
            </div>
          </div>
          
          <div class="row justify-content-center">
            <div class="col-lg-10">
              <div class="test-container">
                <div class="test-header">
                  <h3 class="text-white m-0">AI Test Generator</h3>
                </div>
                
                <div class="test-input-section">
                  <input type="text" class="topic-input" id="topicInput" placeholder="Enter a computer science topic (e.g., Python loops, HTML basics, Algorithms)...">
                  <div class="text-center">
                    <button class="generate-btn" id="generateBtn">Generate Test</button>
                  </div>
                </div>
                
                <div class="test-content" id="testContent">
                  <div class="text-center text-muted py-5">
                    <p>Enter a topic above and click "Generate Test" to create your custom test</p>
                  </div>
                </div>
                
                <div class="test-results" id="testResults">
                  <!-- Results will be displayed here -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="row mt-5">
            <div class="col-md-4 text-center">
              <div class="block-2 red">
                <span class="wrap-icon">
                  <span class="icon-file-text"></span>
                </span>
                <h2>Custom Tests</h2>
                <p>Generate tests on any computer science topic instantly</p>
              </div>
            </div>
            <div class="col-md-4 text-center">
              <div class="block-2 yellow">
                <span class="wrap-icon">
                  <span class="icon-check-circle"></span>
                </span>
                <h2>Instant Feedback</h2>
                <p>Get detailed results showing correct and incorrect answers</p>
              </div>
            </div>
            <div class="col-md-4 text-center">
              <div class="block-2 teal">
                <span class="wrap-icon">
                  <span class="icon-trending-up"></span>
                </span>
                <h2>Track Progress</h2>
                <p>Monitor your learning progress with personalized tests</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div class="generating-overlay" id="generatingOverlay">
        <div class="generating-content">
          <div class="loading-spinner"></div>
          <h4>Generating Your Test</h4>
          <p>AI is creating personalized questions for you...</p>
        </div>
      </div>

      <!-- –§—É—Ç–µ—Ä -->
      <footer class="site-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4">
              <h2 class="footer-heading mb-3">About Us</h2>
              <p class="mb-5">People who believe that learning computer science can be fun and accessible for everyone</p>

              <h2 class="footer-heading mb-4">Newsletter</h2>
              <form action="#" class="d-flex">
                <input type="text" class="form-control mr-3" placeholder="Email">
                <input type="submit" class="btn btn-primary" value="Send">
              </form>
            </div>
            <div class="col-lg-8 ml-auto">
              <div class="row">
                <div class="col-lg-4 ml-auto">
                  <h2 class="footer-heading mb-4">Navigation</h2>
                  <ul class="list-unstyled">
                  <li><a href="index.html" class="nav-link">Home</a></li>
                  <li><a href="chat.html" class="nav-link">Ai Assistant</a></li>
                  <li class="active"><a href="test.html" class="nav-link">Test Generator</a></li>
                  <li><a href="img.html" class="nav-link">Content Finder</a></li>
                  <li><a href="contact.html" class="nav-link">Contact</a></li>
                  <li><a href="edu.html" class="nav-link">Edu</a></li>
                  <li><a href="acc.html" class="nav-link">Account</a></li>
                  </ul>
                </div>
                <div class="col-lg-4">
                  <h2 class="footer-heading mb-4">AI Tools</h2>
                  <ul class="list-unstyled">
                    <li><a href="assistant.html">Learning Assistant</a></li>
                    <li><a href="test-generator.html">Test Generator</a></li>
                    <li><a href="#">Code Examples</a></li>
                    <li><a href="#">Progress Tracking</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row pt-5 mt-5 text-center">
            <div class="col-md-12">
              <div class="border-top pt-5">
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/main.js"></script>
    <script src="js/responsive.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const topicInput = document.getElementById('topicInput');
    const generateBtn = document.getElementById('generateBtn');
    const testContent = document.getElementById('testContent');
    const testResults = document.getElementById('testResults');
    const generatingOverlay = document.getElementById('generatingOverlay');
    
    let currentTest = null;
    let userAnswers = [];
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
    async function generateTest() {
      const topic = topicInput.value.trim();
      
      if (!topic) {
        alert('Please enter a topic for your test');
        return;
      }
      
      // –ü–æ–∫–∞–∑–∞—Ç—å –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
      generatingOverlay.style.display = 'flex';
      
      try {
        const token = localStorage.getItem('aiToolkitToken');
        const headers = {
          'Content-Type': 'application/json'
        };
        
        if (token) {
          headers['Authorization'] = `Bearer ${token}`;
        }
        
        const response = await fetch('/api/generate-test', {
          method: 'POST',
          headers: headers,
          body: JSON.stringify({ topic })
        });
        
        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }
        
        const testData = await response.json();
        currentTest = testData;
        userAnswers = new Array(currentTest.questions.length).fill(null);
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–µ—Å—Ç
        displayTest(currentTest);
        
      } catch (error) {
        console.error('Error generating test:', error);
        // Fallback: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
        currentTest = generateTestQuestions(topic);
        userAnswers = new Array(currentTest.questions.length).fill(null);
        displayTest(currentTest);
      } finally {
        // –°–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
        generatingOverlay.style.display = 'none';
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (fallback)
    function generateTestQuestions(topic) {
      const testTemplates = {
        'python': [
          {
            question: "What is the output of: print(2 + 3 * 4)",
            options: ["20", "14", "24", "Error"],
            correct: 1
          },
          {
            question: "Which keyword is used to define a function in Python?",
            options: ["function", "def", "define", "func"],
            correct: 1
          },
          {
            question: "How do you create a list in Python?",
            options: ["list = ()", "list = []", "list = {}", "list = <>"],
            correct: 1
          },
          {
            question: "What does the 'len()' function do in Python?",
            options: ["Converts to lowercase", "Returns the length", "Rounds a number", "Imports a module"],
            correct: 1
          },
          {
            question: "Which operator is used for exponentiation in Python?",
            options: ["^", "**", "^^", "//"],
            correct: 1
          }
        ],
        'html': [
          {
            question: "What does HTML stand for?",
            options: [
              "Hyper Text Markup Language",
              "High Tech Modern Language", 
              "Hyper Transfer Markup Language",
              "Home Tool Markup Language"
            ],
            correct: 0
          },
          {
            question: "Which tag is used to create a hyperlink?",
            options: ["<link>", "<a>", "<href>", "<hyperlink>"],
            correct: 1
          },
          {
            question: "Which tag is used for the largest heading?",
            options: ["<h6>", "<heading>", "<h1>", "<head>"],
            correct: 2
          },
          {
            question: "Which attribute is used to specify an image source?",
            options: ["src", "link", "source", "img"],
            correct: 0
          },
          {
            question: "Which tag is used to create a line break?",
            options: ["<break>", "<lb>", "<br>", "<newline>"],
            correct: 2
          }
        ],
        'algorithms': [
          {
            question: "What is the time complexity of binary search?",
            options: ["O(n)", "O(log n)", "O(n¬≤)", "O(1)"],
            correct: 1
          },
          {
            question: "Which data structure uses LIFO (Last In First Out) principle?",
            options: ["Queue", "Stack", "Array", "Linked List"],
            correct: 1
          },
          {
            question: "What is the main advantage of using hash tables?",
            options: [
              "Constant time complexity for search operations",
              "Automatic sorting of elements",
              "Unlimited storage capacity",
              "Built-in encryption"
            ],
            correct: 0
          },
          {
            question: "Which sorting algorithm has the best worst-case time complexity?",
            options: ["Bubble Sort", "Quick Sort", "Merge Sort", "Selection Sort"],
            correct: 2
          },
          {
            question: "What does DFS stand for in graph algorithms?",
            options: ["Depth-First Search", "Data Flow Structure", "Digital File System", "Dynamic Function Search"],
            correct: 0
          }
        ],
        'programming': [
          {
            question: "What is a variable in programming?",
            options: [
              "A fixed value that cannot be changed",
              "A container for storing data values",
              "A type of function",
              "A programming language"
            ],
            correct: 1
          },
          {
            question: "What is the purpose of a loop?",
            options: [
              "To store multiple values",
              "To repeat a block of code multiple times",
              "To make decisions in code",
              "To define functions"
            ],
            correct: 1
          },
          {
            question: "Which of these is a programming language?",
            options: ["HTML", "CSS", "Python", "XML"],
            correct: 2
          },
          {
            question: "What does IDE stand for?",
            options: [
              "Integrated Development Environment",
              "Internet Development Engine",
              "Interactive Design Element",
              "International Data Exchange"
            ],
            correct: 0
          },
          {
            question: "What is debugging?",
            options: [
              "Writing new code",
              "Finding and fixing errors in code",
              "Compiling code",
              "Documenting code"
            ],
            correct: 1
          }
        ]
      };
      
      // –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º—ã
      let selectedTemplate = 'programming';
      const topicLower = topic.toLowerCase();
      
      if (topicLower.includes('python') || topicLower.includes('java') || topicLower.includes('javascript')) {
        selectedTemplate = 'python';
      } else if (topicLower.includes('html') || topicLower.includes('css') || topicLower.includes('web')) {
        selectedTemplate = 'html';
      } else if (topicLower.includes('algorithm') || topicLower.includes('sort') || topicLower.includes('search')) {
        selectedTemplate = 'algorithms';
      }
      
      const questions = testTemplates[selectedTemplate] || testTemplates['programming'];
      
      return {
        topic: topic,
        questions: questions
      };
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
    function displayTest(test) {
      let testHTML = `
        <div class="text-center mb-4">
          <h4>Test on: ${test.topic}</h4>
          <p>Answer all questions and click "Submit Test" when finished</p>
        </div>
      `;
      
      test.questions.forEach((q, index) => {
        testHTML += `
          <div class="question-item" data-question-index="${index}">
            <div class="question-header mb-3">
              <span class="question-number">${index + 1}</span>
              <strong>${q.question}</strong>
            </div>
            <div class="options-list">
        `;
        
        q.options.forEach((option, optIndex) => {
          testHTML += `
            <div class="option-item" data-question="${index}" data-option="${optIndex}">
              ${String.fromCharCode(65 + optIndex)}) ${option}
            </div>
          `;
        });
        
        testHTML += `
            </div>
          </div>
        `;
      });
      
      testHTML += `
        <div class="text-center mt-4">
          <button class="submit-btn" id="submitTest">Submit Test</button>
        </div>
      `;
      
      testContent.innerHTML = testHTML;
      
      // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
      document.querySelectorAll('.option-item').forEach(option => {
        option.addEventListener('click', function() {
          const questionIndex = parseInt(this.dataset.question);
          const optionIndex = parseInt(this.dataset.option);
          
          // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ
          const questionItem = this.closest('.question-item');
          questionItem.querySelectorAll('.option-item').forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
          this.classList.add('selected');
          
          // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          userAnswers[questionIndex] = optionIndex;
          console.log(`Question ${questionIndex + 1}: Selected option ${optionIndex}`);
        });
      });
      
      // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
      document.getElementById('submitTest').addEventListener('click', submitTest);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    async function submitTest() {
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–≤–µ—á–µ–Ω—ã
      const unanswered = userAnswers.map((answer, index) => answer === null ? index + 1 : null).filter(val => val !== null);
      
      if (unanswered.length > 0) {
        alert(`Please answer all questions before submitting. Unanswered questions: ${unanswered.join(', ')}`);
        return;
      }
      
      // –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      let correctCount = 0;
      const results = [];
      
      currentTest.questions.forEach((q, index) => {
        const isCorrect = userAnswers[index] === q.correct;
        if (isCorrect) correctCount++;
        
        results.push({
          question: q.question,
          userAnswer: q.options[userAnswers[index]],
          correctAnswer: q.options[q.correct],
          isCorrect: isCorrect,
          userAnswerIndex: userAnswers[index],
          correctAnswerIndex: q.correct
        });
      });
      
      const score = Math.round((correctCount / currentTest.questions.length) * 100);
      
      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ API –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –æ–ø—ã—Ç–µ
      const saveResult = await saveTestResults(correctCount, currentTest.questions.length);
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      displayResults(score, results, saveResult);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞
    async function saveTestResults(correctCount, totalQuestions) {
      try {
        const token = localStorage.getItem('aiToolkitToken');
        if (!token) {
          console.log('User not logged in, skipping result save');
          return null;
        }
        
        const response = await fetch('/api/save-test-result', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            topic: currentTest.topic,
            score: correctCount,
            totalQuestions: totalQuestions
          })
        });
        
        if (response.ok) {
          const resultData = await response.json();
          console.log('Test results saved:', resultData);
          return resultData;
        } else {
          console.error('Failed to save test results:', response.status);
          return null;
        }
      } catch (error) {
        console.error('Error saving test results:', error);
        return null;
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function displayResults(score, results, saveResult) {
      let resultsHTML = `
        <div class="score-display">
          <div class="score-circle">${score}%</div>
          <h4>Test Results</h4>
          <p>You scored ${score}% on the test about ${currentTest.topic}</p>
          <p><strong>${results.filter(r => r.isCorrect).length}</strong> out of <strong>${results.length}</strong> questions correct</p>
      `;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º –æ–ø—ã—Ç–µ
      if (saveResult && saveResult.success) {
        if (saveResult.experience) {
          resultsHTML += `
            <div class="experience-gained">
              üéâ +${saveResult.experience} XP Gained!
            </div>
          `;
        }
        
        if (saveResult.level) {
          const oldLevel = localStorage.getItem('currentLevel') || 1;
          const newLevel = saveResult.level;
          
          if (saveResult.levelUp) {
            resultsHTML += `
              <div class="level-up">
                üöÄ Level Up! You are now Level ${newLevel}
              </div>
            `;
            localStorage.setItem('currentLevel', newLevel);
          } else {
            resultsHTML += `
              <div class="experience-gained">
                üìä Current Level: ${newLevel}
              </div>
            `;
          }
        }
        
        if (saveResult.levelInfo) {
          const levelInfo = saveResult.levelInfo;
          resultsHTML += `
            <div class="experience-gained" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              üìà Progress: ${levelInfo.currentLevelExp || 0}/100 XP to Level ${(levelInfo.level || 1) + 1}
            </div>
          `;
        }
      } else {
        resultsHTML += `
          <div class="experience-gained" style="background: #6c757d;">
            üîê <a href="acc.html" style="color: white; text-decoration: underline;">Login</a> to track your progress and earn XP!
          </div>
        `;
      }
      
      resultsHTML += `</div><h5>Detailed Results:</h5>`;
      
      results.forEach((result, index) => {
        resultsHTML += `
          <div class="result-item ${result.isCorrect ? 'result-correct' : 'result-incorrect'}">
            <div class="d-flex align-items-start">
              <span class="question-number mr-3">${index + 1}</span>
              <div>
                <strong>${result.question}</strong><br>
                <span class="${result.isCorrect ? 'text-success' : 'text-danger'}">
                  Your answer: ${String.fromCharCode(65 + result.userAnswerIndex)}) ${result.userAnswer}
                </span><br>
                ${!result.isCorrect ? `<span class="text-success">Correct answer: ${String.fromCharCode(65 + result.correctAnswerIndex)}) ${result.correctAnswer}</span><br>` : ''}
                <small class="text-muted">${result.isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}</small>
              </div>
            </div>
          </div>
        `;
      });
      
      resultsHTML += `
        <div class="text-center mt-4">
          <button class="new-test-btn" id="newTestBtn">Create New Test</button>
        </div>
      `;
      
      testResults.innerHTML = resultsHTML;
      testResults.style.display = 'block';
      
      // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
      testResults.scrollIntoView({ behavior: 'smooth' });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
      if (saveResult && saveResult.success) {
        updateAuthIndicator();
      }
      
      // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
      document.getElementById('newTestBtn').addEventListener('click', function() {
        topicInput.value = '';
        testContent.innerHTML = '<div class="text-center text-muted py-5"><p>Enter a topic above and click "Generate Test" to create your custom test</p></div>';
        testResults.style.display = 'none';
        currentTest = null;
        userAnswers = [];
        
        // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –≤–µ—Ä—Ö—É
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function updateAuthIndicator() {
      const savedUser = localStorage.getItem('aiToolkitUser');
      if (savedUser) {
        const user = JSON.parse(savedUser);
        showAuthIndicator(user);
      }
    }
    
    function showAuthIndicator(user) {
      // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      const existingIndicator = document.getElementById('authIndicator');
      if (existingIndicator) {
        existingIndicator.remove();
      }
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      const authIndicator = document.createElement('div');
      authIndicator.id = 'authIndicator';
      authIndicator.className = 'auth-indicator';
      authIndicator.innerHTML = `üë§ ${user.username} (Level ${user.level})`;
      document.body.appendChild(authIndicator);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function initializeAccountIntegration() {
      const savedUser = localStorage.getItem('aiToolkitUser');
      if (savedUser) {
        const user = JSON.parse(savedUser);
        
        // –î–æ–±–∞–≤–ª—è–µ–º userEmail –≤ –∑–∞–ø—Ä–æ—Å—ã –∫ API
        window.userEmail = user.email;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        showAuthIndicator(user);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    generateBtn.addEventListener('click', generateTest);
    
    topicInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        generateTest();
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    initializeAccountIntegration();
  });
</script>
</body>
</html>